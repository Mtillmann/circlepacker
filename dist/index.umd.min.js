!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?i(exports):"function"==typeof define&&define.amd?define(["exports"],i):i((t="undefined"!=typeof globalThis?globalThis:t||self).MTCP={})}(this,(function(t){"use strict";var i=class{defaultOptions={spacing:1,numCircles:1e3,minRadius:1,maxRadius:10,higherAccuracy:!1,colors:"auto",minAlpha:1,background:"transparent"};defaultExportOptions={scale:globalThis.devicePixelRatio||1,quality:1,format:"image/png"};options;spareCircles=[];placedCircles=[];dims={width:0,height:0};constructor(t={}){this.options={...this.defaultOptions,...t},["transparent",null,"",!1,void 0].includes(this.options.background)&&(this.options.background=!1);for(let t=0;t<this.options.numCircles;t++)this.spareCircles.push({radius:this.options.minRadius+Math.random()*Math.random()*(this.options.maxRadius-this.options.minRadius)});this.spareCircles.sort(((t,i)=>t.radius-i.radius))}isFilled(t,i,e){return i=Math.round(i),e=Math.round(e),t.data[4*(this.dims.width*e+i)+3]>this.options.minAlpha}isCircleInside(t,i,e,s){if(!this.isFilled(t,i,e-s))return!1;if(!this.isFilled(t,i,e+s))return!1;if(!this.isFilled(t,i+s,e))return!1;if(!this.isFilled(t,i-s,e))return!1;if(this.options.higherAccuracy){const s=Math.cos(Math.PI/4);if(!this.isFilled(t,i+s,e+s))return!1;if(!this.isFilled(t,i-s,e+s))return!1;if(!this.isFilled(t,i-s,e-s))return!1;if(!this.isFilled(t,i+s,e-s))return!1}return!0}touchesPlacedCircle(t,i,e){return this.placedCircles.some((s=>this.dist(t,i,s.x,s.y)<s.radius+e+this.options.spacing))}dist(t,i,e,s){const r=t-e,n=i-s;return Math.sqrt(r*r+n*n)}getCircleColor(t,i,e){if("auto"===this.options.colors){i=Math.round(i),e=Math.round(e);const s=4*(this.dims.width*e+i);if(t.data[s+3]/255<this.options.minAlpha)return!1;return`rgb(${t.data[s]},${t.data[s+1]},${t.data[s+2]})`}return this.options.colors[Math.floor(Math.random()*this.options.colors.length)]}render(t,i){let e=this.spareCircles.length;for(this.dims={width:i,height:t.data.length/i/4};e>0;){e--;const i=this.spareCircles[e];let s=1e3;for(;!i.x&&s-- >0;){const e=Math.random()*this.dims.width,s=Math.random()*this.dims.height;if(this.isCircleInside(t,e,s,i.radius)&&!this.touchesPlacedCircle(e,s,i.radius)){const r=this.getCircleColor(t,e,s);r&&(i.x=e,i.y=s,i.color=r,this.placedCircles.push(i))}}}return this.placedCircles}asSVGString(){return`<svg width="${this.dims.width}" height="${this.dims.height}" viewBox="0 0 ${this.dims.width} ${this.dims.height}" xmlns="http://www.w3.org/2000/svg">`+(this.options.background?`<rect x="0" y="0" width="${this.dims.width}" height="${this.dims.height}" fill="${this.options.background}" />`:"")+this.placedCircles.map((t=>{const{x:i,y:e,radius:s,color:r}=t;return`<circle cx="${i}" cy="${e}" r="${s}" fill="${r}" />`})).join("")+"</svg>"}asSVG(){const t=this.asSVGString();return(new DOMParser).parseFromString(t,"image/svg+xml").documentElement}asCanvas(t={}){const i=(t={...this.defaultExportOptions,...t}).scale,e=document.createElement("canvas");e.width=this.dims.width*i,e.height=this.dims.height*i;const s=e.getContext("2d");this.options.background&&(s.fillStyle=this.options.background,s.fillRect(0,0,e.width,e.height));for(const t of this.placedCircles){const{x:e,y:r,radius:n,color:a}=t;s.fillStyle=String(a),s.beginPath(),s.arc(Number(e*i),Number(r*i),n*i,0,2*Math.PI),s.closePath(),s.fill()}return e}asImageData(t={}){t={...this.defaultExportOptions,...t};const i=this.asCanvas(t);return i.getContext("2d").getImageData(0,0,i.width,i.height)}async asBlob(t={}){t={...this.defaultExportOptions,...t};const i=this.asCanvas(t);return await new Promise(((e,s)=>{i.toBlob((t=>{t?e(t):s(new Error("Blob creation failed"))}),t.format,t.quality)}))}async asBlobURL(t={}){return URL.createObjectURL(await this.asBlob(t))}asDataURL(t={}){return t={...this.defaultExportOptions,...t},this.asCanvas().toDataURL(t.format,t.quality)}asArray(){return this.placedCircles}};async function e(t,i={}){t=t instanceof URL?t.href:t;const e=document.createElement("img");return await new Promise((i=>{e.onload=i,e.src=t})),s(e,i)}function s(t,i={}){const e=document.createElement("canvas");e.width=t.width,e.height=t.height;const s=e.getContext("2d");return s.drawImage(t,0,0),n(s,i)}function r(t,e,s={}){const r=new i(s);return r.render(t,e),r}function n(t,i={}){return r(t.getImageData(0,0,t.canvas.width,t.canvas.height),t.canvas.width,i)}function a(t=200,i=200,e="black",s={}){const r=document.createElement("canvas");r.width=t,r.height=i;const a=r.getContext("2d");return a.fillStyle=e,a.fillRect(0,0,t,i),n(a,s)}t.CirclePacker=i,t.fromBlob=async function(t,i={}){const s=URL.createObjectURL(t);return await e(s,i)},t.fromCanvas=function(t,i={}){return n(t.getContext("2d"),i)},t.fromCircle=function(t=100,i="black",e={}){const s=document.createElement("canvas");s.width=2*t,s.height=2*t;const r=s.getContext("2d");return r.fillStyle=i,r.beginPath(),r.arc(t,t,t,0,2*Math.PI),r.closePath(),r.fill(),n(r,e)},t.fromContext2D=n,t.fromImage=s,t.fromImageData=r,t.fromRect=a,t.fromSquare=function(t=200,i="black",e={}){return a(t,t,i,e)},t.fromURL=e,Object.defineProperty(t,"__esModule",{value:!0})}));
