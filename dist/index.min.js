var t={pack(t,s,i,a){let e=i.length;const n=[],o={width:s,height:t.data.length/s/4};for(;e>0;){e--;const s=i[e];let r=1e3;for(;!s.x&&r-- >0;){const i=Math.random()*o.width,e=Math.random()*o.height;this.isCircleInside(t,o.width,i,e,s.radius,a.higherAccuracy,a.minAlpha)&&(this.touchesPlacedCircle(i,e,s.radius,n,a.spacing)||(s.x=i,s.y=e,n.push(s)))}}return n},isFilled:(t,s,i,a,e)=>(s=Math.round(s),i=Math.round(i),t.data[4*(a*i+s)+3]>e),isCircleInside(t,s,i,a,e,n,o){if(!this.isFilled(t,i,a-e,s,o))return!1;if(!this.isFilled(t,i,a+e,s,o))return!1;if(!this.isFilled(t,i+e,a,s,o))return!1;if(!this.isFilled(t,i-e,a,s,o))return!1;if(n){const e=Math.cos(Math.PI/4);if(!this.isFilled(t,i+e,a+e,s,o))return!1;if(!this.isFilled(t,i-e,a+e,s,o))return!1;if(!this.isFilled(t,i-e,a-e,s,o))return!1;if(!this.isFilled(t,i+e,a-e,s,o))return!1}return!0},touchesPlacedCircle(t,s,i,a,e){return a.some((a=>this.dist(t,s,a.x,a.y)<a.radius+i+e))},dist(t,s,i,a){const e=t-i,n=s-a;return Math.sqrt(e*e+n*n)}},s=class{defaultOptions={spacing:1,numCircles:1e3,minRadius:1,maxRadius:10,higherAccuracy:!1,colors:"auto",minAlpha:1,background:"transparent",useMainThread:!1,reuseWorker:!0};defaultExportOptions={scale:globalThis.devicePixelRatio||1,quality:1,format:"image/png"};options;spareCircles=[];placedCircles=[];dims={width:0,height:0};worker=null;constructor(t={}){this.options={...this.defaultOptions,...t},["transparent",null,"",!1,void 0].includes(this.options.background)&&(this.options.background=!1),"auto"===this.options.colors&&(this.options.colors=[]);for(let t=0;t<this.options.numCircles;t++)this.spareCircles.push({radius:this.options.minRadius+Math.random()*Math.random()*(this.options.maxRadius-this.options.minRadius)});this.spareCircles.sort(((t,s)=>t.radius-s.radius))}getCircleColor(t,s,i){if(0===this.options.colors.length){s=Math.round(s),i=Math.round(i);const a=4*(this.dims.width*i+s);if(t.data[a+3]/255<this.options.minAlpha)return!1;return`rgb(${t.data[a]},${t.data[a+1]},${t.data[a+2]})`}return this.options.colors[Math.floor(Math.random()*this.options.colors.length)]}async pack(s,i){let a=[];return"undefined"==typeof Worker||this.options.useMainThread?a=t.pack(s,i,this.spareCircles,this.options):(this.worker||(this.worker=new Worker("data:text/javascript;base64,dmFyIENvcmVfZGVmYXVsdD17cGFjayhpLHQsZSxzKXtsZXQgcj1lLmxlbmd0aDtjb25zdCBhPVtdLGQ9e3dpZHRoOnQsaGVpZ2h0OmkuZGF0YS5sZW5ndGgvdC80fTtmb3IoO3I+MDspe3ItLTtjb25zdCB0PWVbcl07bGV0IGg9MWUzO2Zvcig7IXQueCYmaC0tID4wOyl7Y29uc3QgZT1NYXRoLnJhbmRvbSgpKmQud2lkdGgscj1NYXRoLnJhbmRvbSgpKmQuaGVpZ2h0O3RoaXMuaXNDaXJjbGVJbnNpZGUoaSxkLndpZHRoLGUscix0LnJhZGl1cyxzLmhpZ2hlckFjY3VyYWN5LHMubWluQWxwaGEpJiYodGhpcy50b3VjaGVzUGxhY2VkQ2lyY2xlKGUscix0LnJhZGl1cyxhLHMuc3BhY2luZyl8fCh0Lng9ZSx0Lnk9cixhLnB1c2godCkpKX19cmV0dXJuIGF9LGlzRmlsbGVkOihpLHQsZSxzLHIpPT4odD1NYXRoLnJvdW5kKHQpLGU9TWF0aC5yb3VuZChlKSxpLmRhdGFbNCoocyplK3QpKzNdPnIpLGlzQ2lyY2xlSW5zaWRlKGksdCxlLHMscixhLGQpe2lmKCF0aGlzLmlzRmlsbGVkKGksZSxzLXIsdCxkKSlyZXR1cm4hMTtpZighdGhpcy5pc0ZpbGxlZChpLGUscytyLHQsZCkpcmV0dXJuITE7aWYoIXRoaXMuaXNGaWxsZWQoaSxlK3Iscyx0LGQpKXJldHVybiExO2lmKCF0aGlzLmlzRmlsbGVkKGksZS1yLHMsdCxkKSlyZXR1cm4hMTtpZihhKXtjb25zdCByPU1hdGguY29zKE1hdGguUEkvNCk7aWYoIXRoaXMuaXNGaWxsZWQoaSxlK3IscytyLHQsZCkpcmV0dXJuITE7aWYoIXRoaXMuaXNGaWxsZWQoaSxlLXIscytyLHQsZCkpcmV0dXJuITE7aWYoIXRoaXMuaXNGaWxsZWQoaSxlLXIscy1yLHQsZCkpcmV0dXJuITE7aWYoIXRoaXMuaXNGaWxsZWQoaSxlK3Iscy1yLHQsZCkpcmV0dXJuITF9cmV0dXJuITB9LHRvdWNoZXNQbGFjZWRDaXJjbGUoaSx0LGUscyxyKXtyZXR1cm4gcy5zb21lKChzPT50aGlzLmRpc3QoaSx0LHMueCxzLnkpPHMucmFkaXVzK2UrcikpfSxkaXN0KGksdCxlLHMpe2NvbnN0IHI9aS1lLGE9dC1zO3JldHVybiBNYXRoLnNxcnQocipyK2EqYSl9fTtzZWxmLm9ubWVzc2FnZT1pPT57cG9zdE1lc3NhZ2UoQ29yZV9kZWZhdWx0LnBhY2soaS5kYXRhLmltYWdlRGF0YSxpLmRhdGEuaW1hZ2VXaWR0aCxpLmRhdGEuc3BhcmVDaXJjbGVzLGkuZGF0YS5vcHRpb25zKSl9Ow==")),a=await new Promise((t=>{this.worker.onmessage=s=>t(s.data),this.worker.postMessage({imageData:s,imageWidth:i,spareCircles:this.spareCircles,options:this.options})})),this.options.reuseWorker||this.worker.terminate()),this.dims={width:i,height:s.data.length/i/4},this.placedCircles=a.reduce(((t,i)=>{const a=this.getCircleColor(s,i.x,i.y);return a&&(i.color=a,t.push(i)),t}),[]),this.placedCircles}asSVGString(){return`<svg width="${this.dims.width}" height="${this.dims.height}" viewBox="0 0 ${this.dims.width} ${this.dims.height}" xmlns="http://www.w3.org/2000/svg">`+(this.options.background?`<rect x="0" y="0" width="${this.dims.width}" height="${this.dims.height}" fill="${this.options.background}" />`:"")+this.placedCircles.map((t=>{const{x:s,y:i,radius:a,color:e}=t;return`<circle cx="${s}" cy="${i}" r="${a}" fill="${e}" />`})).join("")+"</svg>"}asSVG(){const t=this.asSVGString();return(new DOMParser).parseFromString(t,"image/svg+xml").documentElement}asCanvas(t={}){const s=(t={...this.defaultExportOptions,...t}).scale,i=document.createElement("canvas");i.width=this.dims.width*s,i.height=this.dims.height*s;const a=i.getContext("2d");this.options.background&&(a.fillStyle=this.options.background,a.fillRect(0,0,i.width,i.height));for(const t of this.placedCircles){const{x:i,y:e,radius:n,color:o}=t;a.fillStyle=String(o),a.beginPath(),a.arc(Number(i*s),Number(e*s),n*s,0,2*Math.PI),a.closePath(),a.fill()}return i}asImageData(t={}){t={...this.defaultExportOptions,...t};const s=this.asCanvas(t);return s.getContext("2d").getImageData(0,0,s.width,s.height)}async asBlob(t={}){t={...this.defaultExportOptions,...t};const s=this.asCanvas(t);return await new Promise(((i,a)=>{s.toBlob((t=>{t?i(t):a(new Error("Blob creation failed"))}),t.format,t.quality)}))}async asBlobURL(t={}){return URL.createObjectURL(await this.asBlob(t))}asDataURL(t={}){return t={...this.defaultExportOptions,...t},this.asCanvas().toDataURL(t.format,t.quality)}asArray(){return this.placedCircles}};async function i(t,s={}){const i=URL.createObjectURL(t);return await a(i,s)}async function a(t,s={}){t=t instanceof URL?t.href:t;const i=document.createElement("img");return await new Promise((s=>{i.onload=s,i.src=t})),await e(i,s)}async function e(t,s={}){const i=document.createElement("canvas");i.width=t.width,i.height=t.height;const a=i.getContext("2d");return a.drawImage(t,0,0),await o(a,s)}async function n(t,i,a={}){const e=new s(a);return await e.pack(t,i),e}async function o(t,s={}){return await n(t.getImageData(0,0,t.canvas.width,t.canvas.height),t.canvas.width,s)}async function r(t,s={}){const i=t.getContext("2d");return await o(i,s)}async function h(t=200,s="black",i={}){return await l(t,t,s,i)}async function c(t=100,s="black",i={}){const a=document.createElement("canvas");a.width=2*t,a.height=2*t;const e=a.getContext("2d");return e.fillStyle=s,e.beginPath(),e.arc(t,t,t,0,2*Math.PI),e.closePath(),e.fill(),await o(e,i)}async function l(t=200,s=200,i="black",a={}){const e=document.createElement("canvas");e.width=t,e.height=s;const n=e.getContext("2d");return n.fillStyle=i,n.fillRect(0,0,t,s),await o(n,a)}export{s as CirclePacker,i as fromBlob,r as fromCanvas,c as fromCircle,o as fromContext2D,e as fromImage,n as fromImageData,l as fromRect,h as fromSquare,a as fromURL};
